---
title: "p8105_hw3_sy3352"
author: "Su Yan"
date: "2025-10-06"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(p8105.datasets)
data("instacart")
```

# Problem 1

The `instacart` data set contains data of order details people placed on instacart in 2017. It contains `r nrow(instacart)` observations and `r ncol(instacart)` columns. Each row gives detailed information of one product in an order. Some of the key variables are `order_id` `product_id` `reordered` `order_dow` `order_hour_of_day` `product_name` `aisle` and `department`. For example, row 3859 displayed an **Organic Baby Carrots**
 ordered by userid **198041** on Saturday afternoon (`order_dow`: 6 and `order_hour_of_day`: 18), which belongs to aisle **packaged vegetables fruits** and department **produce**.

```{r}
aisle_amount = count(instacart, aisle, sort = TRUE)
aisle_amount
```
There are `r nrow(distinct(instacart,aisle))` aisles. The most ordered aisles are `fresh vegetables`, `fresh fruits`, `packaged vegetables fruits`, `yogurt` and `packaged cheese`.

```{r}
aisle_amount = filter(aisle_amount, n>10000) 
aisle_amount |> 
  ggplot(aes(x = reorder(aisle,n), y = n)) + 
  geom_col() +
  coord_flip(ylim = c(10000, NA)) + 
  scale_y_continuous(breaks = c(10000, 40000, 80000, 120000)) +
  labs(title = "Number of items ordered in each aisle (# > 10000)",
       x = "aisle",
       y = "number of items ordered")
```

Most Popular Items in Selected Aisles:
```{r}
top_3_aisle = filter(instacart, aisle == c("baking ingredients", "dog food care", "packaged vegetables fruits")) |> 
  select(aisle, product_name) |> 
  group_by(aisle, product_name) |> 
  summarize(number_items_ordered = n()) |> 
  group_by(aisle) |> 
  slice_max(number_items_ordered, n = 3) |> 
  knitr::kable(digits = 0) 
top_3_aisle
```

The mean hour of the day at which the selected two products are ordered:
```{r}
product_week_hour = filter(instacart, product_name == c("Pink Lady Apples", "Coffee Ice Cream")) |> 
  select(order_dow, product_name, order_hour_of_day) |> 
  pivot_wider(names_from = order_dow,
              values_from = order_hour_of_day,
              names_prefix = "day_",
              values_fn = mean) |> 
  rename(Sunday = "day_0", Monday = "day_1", Tuesday = "day_2", Wednesday = "day_3",
         Thursday = "day_4", Friday = "day_5", Saturday = "day_6") |> 
  select(product_name, Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday) |> 
  knitr::kable(digits = 0)
product_week_hour
```

# Problem 2

```{r}
rent_df = read_csv("data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |> 
  pivot_longer(cols = 10:125,
               names_to = "date",
               values_to = "rent_rate") |> 
  janitor::clean_names() |> 
  select(-region_type, -state_name, -state, -city, -metro, -region_id, -size_rank) |> 
  rename(zip_code = region_name)

zip_df = read_csv("data/Zip Codes.csv") |> 
  janitor::clean_names() |> 
  select(-county_code, -county_fips, -state_fips, -file_date, -county)

rent_neigh_joint_df = rent_df |> 
  left_join(zip_df, by = c("zip_code")) |> 
  relocate(last_col(), .after = 2) |> 
  drop_na(rent_rate)
```

```{r}
count_zip = rent_neigh_joint_df |> 
  group_by(zip_code) |> 
  summarize(month_count = n()) 
```

`r sum(count_zip$month_count == 116)` zip codes are observed 116 times. `r sum(count_zip$month_count < 10)` zip codes are observed less than 10 times. Possible reasons for some zip codes to be observed fewer than others can be that they are commercial zip codes or PO-box zip codes which does not represent residential significance and thus does not provide consistent rent information. For example, the zip code **10044** was observed 9 times. It stands for Roosevelt island which has a small area and thus less housing for rent, resulting in less rental information provided. 

# Problem 3